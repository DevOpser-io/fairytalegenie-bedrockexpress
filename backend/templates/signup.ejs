<% title = 'Sign Up' %>
<link rel="stylesheet" href="/static/auth.css">
<%- include('./partials/favicon') %>

<div class="auth-form-container">
  <h2>‚ú® Fairytale Genie</h2>
  <h3 style="color: #667eea; margin-bottom: 20px;">Coming Soon!</h3>
  
  <div style="background: #f8f9fa; border-radius: 8px; padding: 25px; margin-bottom: 25px; text-align: center;">
    <h4 style="color: #2c3e50; margin-bottom: 15px;">üöÄ We're Building Something Magical</h4>
    <p style="color: #7f8c8d; line-height: 1.6; margin-bottom: 20px;">
      Fairytale Genie is currently under development! We're crafting an amazing AI-powered platform that will create personalized bedtime stories and beautiful illustrations for your children.
    </p>
    <p style="color: #2c3e50; font-weight: 600; margin-bottom: 0;">
      Join our waiting list to be the first to know when we launch!
    </p>
  </div>
  
  <form action="https://formspree.io/f/xdkzwwjb" method="POST" class="auth-form" id="waitlist-form">
    <!-- Hidden field to redirect to our thank you page if JavaScript is disabled -->
    <input type="hidden" name="_next" value="<%= thankYouUrl %>">
    <!-- Optional: Disable Formspree's default captcha -->
    <input type="hidden" name="_captcha" value="false">
    <div id="form-messages" style="display: none; padding: 15px; margin-bottom: 20px; border-radius: 6px;"></div>
    
    <div class="form-group">
      <label for="email">Email Address</label>
      <input type="email" id="email" name="email" required autofocus placeholder="Enter your email to join the waiting list">
    </div>
    
    <div class="form-group">
      <label for="name">Parent/Guardian Name (Optional)</label>
      <input type="text" id="name" name="name" placeholder="Your name">
    </div>
    
    <div class="form-group">
      <label for="children_ages">Children's Ages (Optional)</label>
      <input type="text" id="children_ages" name="children_ages" placeholder="e.g., 3, 5, 7 years old">
    </div>
    
    <button type="submit" class="auth-button" id="submit-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      üé™ Join the Waiting List
    </button>
    
    <div style="background: #e8f5e8; border-radius: 6px; padding: 15px; margin-top: 20px; font-size: 0.9rem;">
      <p style="margin: 0; color: #2e7d32;">
        <strong>What to expect:</strong> Personalized fairytales, AI-generated illustrations, age-appropriate content, and magical bedtime experiences!
      </p>
    </div>
    
    <div class="auth-links">
      <a href="/pricing">Pricing</a> ‚Ä¢ 
      <a href="/terms">Terms</a> ‚Ä¢ 
      <a href="/privacy">Privacy</a> ‚Ä¢ 
      <a href="/refund">Refunds</a>
    </div>
  </form>
</div>

<script nonce="<%= cspNonce %>">
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('waitlist-form');
  const submitBtn = document.getElementById('submit-btn');
  const messages = document.getElementById('form-messages');
  
  function showMessage(type, text) {
    messages.style.display = 'block';
    messages.className = type === 'success' ? 'success-message' : 'error-message';
    messages.style.background = type === 'success' ? '#e8f5e8' : '#ffebee';
    messages.style.color = type === 'success' ? '#2e7d32' : '#c62828';
    messages.style.border = type === 'success' ? '2px solid #4caf50' : '2px solid #f44336';
    messages.textContent = text;
  }
  
  function hideMessage() {
    messages.style.display = 'none';
  }
  
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Hide any previous messages
    hideMessage();
    
    // Update button state
    const originalText = submitBtn.textContent;
    submitBtn.textContent = '‚è≥ Joining...';
    submitBtn.disabled = true;
    
    // Prepare form data
    const formData = new FormData(form);
    
    // Submit to Formspree
    fetch('https://formspree.io/f/xdkzwwjb', {
      method: 'POST',
      body: formData,
      headers: {
        'Accept': 'application/json'
      }
    })
    .then(function(response) {
      if (response.ok) {
        showMessage('success', 'üéâ Thank you for joining our waiting list! We\'ll notify you as soon as Fairytale Genie is ready.');
        form.reset();
      } else {
        return response.json().then(function(data) {
          if (data.errors) {
            const errorMessages = data.errors.map(function(error) {
              return error.message;
            }).join(', ');
            throw new Error(errorMessages);
          } else {
            throw new Error('There was a problem submitting your form. Please try again.');
          }
        });
      }
    })
    .catch(function(error) {
      console.error('Form submission error:', error);
      showMessage('error', 'Oops! There was a problem joining the waiting list. Please try again or contact us at info@fairytalegenie.com');
    })
    .finally(function() {
      // Reset button state
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
  });
});
</script>

